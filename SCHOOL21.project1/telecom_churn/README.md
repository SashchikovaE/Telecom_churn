# Telecom Churn Prediction

Проект по предсказанию оттока клиентов телеком-компании с использованием кастомной и sklearn-версии логистической регрессии.

## Содержание
- [Установка](#установка)
- [Структура проекта](#структура-проекта)
- [Данные](#данные)
- [Предобработка](#предобработка)
- [Модели](#модели)
- [Результаты](#результаты)
- [API](#api)
- [Как улучшить?](#как-улучшить)
- [Лицензия](#лицензия)

## Установка

### Вариант 1: С использованием Docker

1. **Установите Docker (если еще не установлен)**:
 - [Docker Desktop для Windows/Mac](https://www.docker.com/products/docker-desktop)
 - Для Linux: используйте пакетный менеджер вашего дистрибутива

2. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/SashchikovaE/Telecom_churn.git
   cd SCHOOL21.project1/telecom_churn
   ```

3. **Соберите и запустите контейнер**:
    ```bash
   docker build -t telecom-churn .
   docker run telecom-churn
   ```
   
### Вариант 2: Без использования Docker

1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/SashchikovaE/Telecom_churn.git
   cd SCHOOL21.project1/telecom_churn
   ```

2. **Создайте виртуальное окружение**:
    ``` bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate     # Windows
   ```

2. **Установите зависимости**:
    ``` bash
   pip install -r requirements.txt
   ```
   
3. **Запустите проект**:
    ``` bash
   python main.py
   ```

## Структура проекта
```
telecom_churn/
├── data/                                  # Исходные данные
│   └── telecom.csv          
├── api_files/                             # Файлы для приложения
│   ├── normalization.joblib               # Параметры нормализации
│   └── log_regression_original.joblib     # Модель
├── src/
│   ├── images
│   ├── preprocessing.py                   # Предобработка данных
│   ├── logistic_regression_custom.py      # Кастомная логистическая регрессия
│   ├── logistic_regression_original.py    # Sklearn логистическая регрессия
│   ├── random_forest_original.py          # Sklearn случайный лес
│   ├── random_forest_custom.py            # Кастомный случайный лес
│   └── main.py                            # Точка входа
├── api/                                   # Приложение
│   ├── api.py
│   └── templates/                             # Формы для приложения
│       ├── form.html
│       └── index.html  
├── Dockerfile                             # Докер файл
├── requirements.txt                       # Требования
├── tests.py                               # Тесты
└── README.md
```

## Данные

[Датасет с Kaggle](https://www.kaggle.com/datasets/blastchar/telco-customer-churn) содержит информацию о клиентах телеком-компании:

- Целевая переменная: Churn (1/0)
- Признаки
    - Платежи (Ежемесячные/Общие расходы)
    - Услуги (Интернет, ТВ и т.д.)
    - Демографические (пол, семейное положение и т.д.)
  
## Предобработка

В качестве предобработки данных мною было выполнено:
- Кодирование категориальных данных
- Преобразование object столбцов в численные
- Обработка пустых ячеек
- Анализ и визуализация выбросов
- Добавление новых признаков
- Z-score нормализация данных
- Визуализация распределения churn 

![churn](src/images/churn_distribution.png)
- Построение матрицы корреляций 
 
![матрицы корреляций](src/images/correlation_matrix.png)

## Модели

### Кастомная логистическая регрессия
Была реализована с нуля
- Функция логистической регрессии
- Метрики accuracy, precision, recall, f1
- Кросс-валидация
- Реализация подбора параметров в конструкторе класса

### Sklearn логистическая регрессия
Используется для сравнения с кастомной реализацией

### Sklearn Random Forest
Реализация ансамблевой модели для улучшения качества
предсказаний

## API
FastAPI приложение для предсказания оттока клиентов
в реальном времени с использованием библиотеки Flask.

Были предусмотрены:
- Предобработка входных данных
- Использование обученной модели Logistic Regression
- Сохранение параметров нормализации при начальной
предобработки в файл для использования в приложении
- Форма входа
- Форма предсказания
- Возврат вероятности оттока


## Результаты

| Метрика   | Кастомная LR | Sklearn LR | Кастомная cv LR | Sklearn cv LR | Sklearn RF | Sklearn cv RF |
|-----------|--------------|------------|-----------------|---------------|------------|---------------|
| Accuracy  | 0.8169       | 0.7438     | 0.8008          | 0.7464        | 0.7761     | 0.7768        |
| Precision | 0.6976       | 0.5109     | 0.6605          | 0.5139        | 0.5632     | 0.5617        |
| Recall    | 0.5442       | 0.8168     | 0.5116          | 0.8008        | 0.6965     | 0.7196        |
| F1        | 0.6114       | 0.6286     | 0.5765          | 0.6268        | 0.6228     | 0.6305        |
| ROC-AUC   | 0.7296       | 0.7671     | 0.7083          | 0.7637        | 0.7507     | 0.7585        |

### Выводы
- В случае если нам нужно гарантированно удержать клиентов, 
используем кастомную модель со стандартным разделением данных,
так как метрика precision именно этой модели показывает
наибольший результат
- Если компания готова предоставлять скидки клиентам, 
которые фактически не уходят (ложноположительные случаи, 
а это 19%), стоит выбрать sklearn-версию модели с высоким 
recall
- Кастомная версия показала лучшие результаты метрик accuracy, 
precision
- Но в целом, лучшие результаты метрик показала sklearn версия со стандартным
сплитом.

## Как улучшить?

- Добавление unit-тестов
- Добавление кастомной модели RandomForest
- Автоматизация документации

## Лицензия
Этот проект распространяется под лицензией MIT. Вы можете 
свободно использовать, изменять и распространять его при условии 
сохранения уведомления об авторстве.~~
